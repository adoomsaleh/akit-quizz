<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AKit ‚Äî Calm Lo-Fi Quiz</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600;800&family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg1:#0f1026;
  --bg2:#2b1b4a;
  --card-bg: rgba(255,255,255,0.03);
  --glass: rgba(255,255,255,0.05);
  --accent: #8be7e0;
  --muted: rgba(255,255,255,0.85);
  --round:16px;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:linear-gradient(135deg,var(--bg1),var(--bg2));color:#fff;overflow:hidden}
.app{width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
.shell{
  width:100%;max-width:1100px;height:90vh;border-radius:20px;padding:20px;
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  box-shadow: 0 30px 80px rgba(0,0,0,0.6);
  display:grid;grid-template-columns:380px 1fr;gap:18px;position:relative;overflow:hidden;
}

/* Left column: home */
.left{
  padding:18px;border-radius:14px;background:var(--card-bg);border:1px solid rgba(255,255,255,0.03);
  display:flex;flex-direction:column;gap:14px;align-items:stretch;
}
.brand{display:flex;gap:12px;align-items:center}
.logo{
  width:84px;height:84px;border-radius:14px;background:linear-gradient(135deg,#fff3c6,#ffd6a5);display:flex;align-items:center;justify-content:center;font-family:"Baloo 2",cursive;color:#221;font-weight:900;font-size:24px;box-shadow:0 10px 30px rgba(0,0,0,0.35)
}
.title{font-family:"Baloo 2",cursive;font-size:22px;margin:0}
.subtitle{font-size:12px;color:var(--muted)}

/* mode buttons */
.modes{display:flex;flex-direction:column;gap:10px}
.big-btn{
  display:flex;align-items:center;gap:12px;padding:12px;border-radius:12px;border:none;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));cursor:pointer;color:#fff;font-weight:700;transition:transform .16s, box-shadow .16s;
}
.big-btn:hover{transform:translateY(-6px);box-shadow:0 16px 36px rgba(0,0,0,0.45)}
.k{width:48px;height:48px;border-radius:10px;background:var(--glass);display:flex;align-items:center;justify-content:center;font-weight:800;color:#fff}
.controls{display:flex;gap:8px;flex-wrap:wrap}
.small-btn{padding:8px 12px;border-radius:10px;border:none;background:#00aaff;color:#fff;cursor:pointer;font-weight:700}

/* icon cloud */
.icon-cloud{display:flex;flex-wrap:wrap;gap:10px;padding:8px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.02));}
.icon-card{width:96px;height:84px;border-radius:12px;background:linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.005));display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:transform .18s}
.icon-card:hover{transform:translateY(-6px);box-shadow:0 12px 26px rgba(0,0,0,0.35)}
.icon-emoji{font-size:28px}
.icon-label{font-size:12px;color:var(--muted);margin-top:6px}

/* right: quiz area */
.right{padding:18px;border-radius:14px;background:linear-gradient(180deg, rgba(0,0,0,0.03), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.02);display:flex;flex-direction:column;gap:12px}
.topbar{display:flex;justify-content:space-between;align-items:center}
.players{display:flex;gap:8px;align-items:center}
.player-pill{padding:8px 12px;border-radius:999px;background:linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));font-weight:700}
.turnIndicator{color:var(--accent);font-weight:800}

.quiz-card{padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.01));border:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;gap:12px}
.question{font-weight:800;font-size:18px}
.options{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.option-btn{padding:12px;border-radius:12px;border:none;background:linear-gradient(180deg,#ffffff06,#ffffff03);cursor:pointer;font-weight:800;transition:transform .12s}
.option-btn:hover{transform:translateY(-6px);box-shadow:0 12px 26px rgba(0,0,0,0.35)}
.feedback{font-weight:800;min-height:24px}
.timer{font-weight:700}
.progress{height:10px;background:rgba(255,255,255,0.04);border-radius:8px;overflow:hidden}
.bar{height:100%;width:0%;background:linear-gradient(90deg,#7ef9ff,#7ef9b5);transition:width .3s}

.hidden{display:none}

/* subtle particles layer */
#particles{position:absolute;inset:0;z-index:0;pointer-events:none}

/* responsive */
@media (max-width:980px){
  .shell{grid-template-columns:1fr;height:100%}
  .logo{width:64px;height:64px;font-size:18px}
}
</style>
</head>
<body>
<div class="app">
  <div class="shell" id="shell">
    <!-- particles canvas -->
    <canvas id="particles"></canvas>

    <!-- LEFT: home -->
    <div class="left" id="left">
      <div class="brand">
        <div class="logo">AKit</div>
        <div>
          <div class="title">AKit Quiz</div>
          <div class="subtitle">Calm lo-fi, quizzes, and good vibes</div>
        </div>
      </div>

      <div class="modes">
        <button class="big-btn" id="soloBtn"><div class="k">S</div>Solo Mode <div style="margin-left:auto;font-size:12px;color:var(--muted)">Single player</div></button>
        <button class="big-btn" id="multiBtn"><div class="k">M</div>Multiplayer <div style="margin-left:auto;font-size:12px;color:var(--muted)">Up to 4 players</div></button>
      </div>

      <div class="controls">
        <button class="small-btn" id="openPlayers">Player Setup</button>
        <button class="small-btn" id="how">How to Play</button>
        <button class="small-btn" id="musicToggle" data-want="off">Play Music</button>
      </div>

      <div style="margin-top:12px">
        <div class="icon-cloud" id="iconCloud" aria-hidden="false"></div>
      </div>

      <div style="font-size:12px;color:var(--muted);margin-top:auto">Tip: first click anywhere enables audio (browser requirement).</div>
    </div>

    <!-- RIGHT: quiz -->
    <div class="right" id="right">
      <div class="topbar">
        <div class="players" id="playerStrip"></div>
        <div class="turnIndicator" id="turnIndicator">Welcome ‚Äî pick a mode</div>
      </div>

      <div class="quiz-card" id="menuCard">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:900">Ready to Play?</div>
          <div style="font-size:13px;color:var(--muted)">Select a topic from the icons</div>
        </div>
        <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
          <button class="small-btn" id="startLast">Start Last Selected</button>
          <button class="small-btn" id="viewScores">View Scores</button>
          <button class="small-btn" id="resetBtn">Reset</button>
        </div>
      </div>

      <div class="quiz-card hidden" id="quizCard">
        <div class="question" id="question">Question</div>
        <div class="options" id="options"></div>
        <div class="feedback" id="feedback"></div>

        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="timer" id="timer">‚è∞ 10s</div>
          <div style="width:65%"><div class="progress"><div class="bar" id="bar"></div></div></div>
        </div>

        <div class="leaderboard" id="leaderboard"></div>

        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
          <div class="achievements" id="achievements"></div>
          <div style="display:flex;gap:8px">
            <button class="small-btn hidden" id="nextBtn">Next</button>
            <button class="small-btn" id="endBtn">End</button>
          </div>
        </div>
      </div>

      <div class="quiz-card hidden" id="endCard">
        <h3>Quiz Finished üéâ</h3>
        <div class="leaderboard" id="finalLeaderboard"></div>
        <div style="display:flex;justify-content:flex-end;margin-top:8px">
          <button class="small-btn" id="backMenu">Back</button>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
/* -------------------------
   Particles (subtle background)
   ------------------------- */
const canvas = document.getElementById('particles');
const shell = document.getElementById('shell');
const ctx = canvas.getContext('2d');
let W, H, parts = [];
function resize(){ W = canvas.width = shell.clientWidth; H = canvas.height = shell.clientHeight; }
window.addEventListener('resize', resize);
resize();

function rand(min,max){ return Math.random()*(max-min)+min; }
for(let i=0;i<60;i++){
  parts.push({x: rand(0,W), y: rand(0,H), r: rand(0.6,2.2), vx: rand(-0.2,0.2), vy: rand(-0.15,-0.5), hue: rand(210,270), a: rand(0.08,0.28)});
}
function draw(){
  ctx.clearRect(0,0,W,H);
  parts.forEach(p=>{
    p.x += p.vx; p.y += p.vy;
    if(p.y < -10){ p.y = H + 10; p.x = rand(0,W); }
    if(p.x < -10) p.x = W + 10;
    if(p.x > W + 10) p.x = -10;
    ctx.beginPath();
    ctx.fillStyle = `hsla(${p.hue},60%,70%,${p.a})`;
    ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
    ctx.fill();
  });
  requestAnimationFrame(draw);
}
draw();

/* -------------------------
   Audio (soft lo-fi + SFX)
   ------------------------- */
const MUSIC_URL = 'https://cdn.pixabay.com/download/audio/2022/08/06/audio_7d6076e32b.mp3?filename=calm-lofi-beat-110-bpm-124618.mp3';
let audioCtx = null, musicGain = null, sfxGain = null, musicBuf = null, musicSource = null, musicPlaying = false;

async function initAudio(){
  if(audioCtx) return;
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  musicGain = audioCtx.createGain(); musicGain.gain.value = 0.8;
  sfxGain = audioCtx.createGain(); sfxGain.gain.value = 0.9;
  musicGain.connect(audioCtx.destination);
  sfxGain.connect(audioCtx.destination);
  try {
    const r = await fetch(MUSIC_URL);
    const arr = await r.arrayBuffer();
    musicBuf = await audioCtx.decodeAudioData(arr);
  } catch(e){ console.warn('Music load failed', e); }
}

function startMusic(){
  if(!audioCtx) initAudio();
  if(!musicBuf) return;
  stopMusic();
  musicSource = audioCtx.createBufferSource();
  musicSource.buffer = musicBuf;
  musicSource.loop = true;
  musicSource.connect(musicGain);
  musicSource.start();
  musicPlaying = true;
  document.getElementById('musicToggle').textContent = 'Pause Music';
  document.getElementById('musicToggle').dataset.want = 'on';
}

function stopMusic(){
  if(musicSource){ try{ musicSource.stop(); }catch(e){} musicSource=null; }
  musicPlaying = false;
  document.getElementById('musicToggle').textContent = 'Play Music';
  document.getElementById('musicToggle').dataset.want = 'off';
}

function playSfx(type){
  if(!audioCtx) return;
  const now = audioCtx.currentTime;
  if(type==='click'){
    const o = audioCtx.createOscillator(), g = audioCtx.createGain();
    o.type = 'triangle'; o.frequency.value = 640;
    o.connect(g); g.connect(sfxGain);
    g.gain.setValueAtTime(0.0001, now); g.gain.linearRampToValueAtTime(0.06, now+0.01); g.gain.exponentialRampToValueAtTime(0.0001, now+0.22);
    o.start(now); o.stop(now+0.22);
  } else if(type==='correct'){
    const o = audioCtx.createOscillator(), g = audioCtx.createGain();
    o.type='sine'; o.frequency=880; o.connect(g); g.connect(sfxGain);
    g.gain.linearRampToValueAtTime(0.12, now+0.01); g.gain.exponentialRampToValueAtTime(0.0001, now+0.5);
    o.start(now); o.stop(now+0.5);
  } else if(type==='wrong'){
    const o = audioCtx.createOscillator(), g = audioCtx.createGain();
    o.type='sawtooth'; o.frequency=160; o.connect(g); g.connect(sfxGain);
    g.gain.linearRampToValueAtTime(0.08, now+0.01); g.gain.exponentialRampToValueAtTime(0.0001, now+0.4);
    o.start(now); o.stop(now+0.4);
  } else if(type==='win'){
    [660,880,990].forEach((n,i)=>{ const o=audioCtx.createOscillator(), g=audioCtx.createGain(); o.type='sine'; o.frequency=n; o.connect(g); g.connect(sfxGain); const t = now + i*0.08; g.gain.linearRampToValueAtTime(0.12, t+0.01); g.gain.exponentialRampToValueAtTime(0.0001, t+0.42); o.start(t); o.stop(t+0.6); });
  }
}

/* ensure audio is enabled after the first user gesture (autoplay policy) */
document.addEventListener('pointerdown', async function enableAudioOnce(){
  await initAudio();
  // if user pressed the Play Music button (dataset.want === 'on') we already start on that click
  if(document.getElementById('musicToggle').dataset.want === 'on' && !musicPlaying){
    startMusic();
  }
  document.removeEventListener('pointerdown', enableAudioOnce);
});

/* hook music toggle button */
document.getElementById('musicToggle').addEventListener('click', async (e)=>{
  await initAudio();
  if(!musicPlaying){
    startMusic();
    playSfx('click');
  } else {
    stopMusic();
    playSfx('click');
  }
});

/* -------------------------
   UI wiring + Gamemodes
   ------------------------- */
const iconCloud = document.getElementById('iconCloud');
const GAMEMODES = [
  {id:'akit',emoji:'üß†',label:'AKit'},
  {id:'planet',emoji:'ü™ê',label:'Planet'},
  {id:'tech',emoji:'üíæ',label:'Tech'},
  {id:'math',emoji:'‚àë',label:'Math'},
  {id:'music',emoji:'üéµ',label:'Music'},
  {id:'animals',emoji:'üêæ',label:'Animals'},
  {id:'trivia',emoji:'‚ùì',label:'Trivia'}
];
let selectedGamemode = 'akit';
let lastSelected = 'akit';
GAMEMODES.forEach(g=>{
  const node = document.createElement('div');
  node.className = 'icon-card';
  node.innerHTML = `<div class="icon-emoji">${g.emoji}</div><div class="icon-label">${g.label}</div>`;
  node.onclick = ()=>{
    selectedGamemode = g.id; lastSelected = g.id;
    document.getElementById('turnIndicator').textContent = 'Selected: ' + g.label;
    playSfx('click');
  };
  iconCloud.appendChild(node);
});

/* buttons */
document.getElementById('soloBtn').addEventListener('click', ()=>{ mode = 'solo'; openPlayerSetup(); playSfx('click'); });
document.getElementById('multiBtn').addEventListener('click', ()=>{ mode = 'multi'; openPlayerSetup(); playSfx('click'); });
document.getElementById('openPlayers').addEventListener('click', ()=>{ openPlayerSetup(); playSfx('click'); });
document.getElementById('how').addEventListener('click', ()=>{ alert('Take turns answering questions. Correct answers build combos. Solo: answer through entire quiz. Multiplayer: players take turns.'); });
document.getElementById('startLast').addEventListener('click', ()=>{ if(players.length===0){ alert('Please set up players first (Player Setup).'); return; } startQuiz(); });
document.getElementById('resetBtn').addEventListener('click', ()=>{ players = []; renderPlayers(); playSfx('click'); menuCard.scrollIntoView({behavior:'smooth'}); });
document.getElementById('viewScores').addEventListener('click', ()=>{ alert('Scores: ' + (players.map(p=>p.name+': '+p.score).join(', ') || 'none')); });
document.getElementById('backMenu').addEventListener('click', ()=>{ menuReturn(); });

/* Player setup (simple modal prompts so UI stays clean & reliable) */
let mode = 'solo'; // 'solo' | 'multi'
let players = []; // {name,score,combo}

function openPlayerSetup(){
  if(mode === 'solo'){
    const n = prompt('Enter your name (solo):', 'Player');
    if(!n) return;
    players = [{name:n.trim(), score:0, combo:0}];
  } else {
    const names = [];
    for(let i=1;i<=4;i++){
      const v = prompt(`Player ${i} name (leave blank to skip):`, i===1?'Player 1':'');
      if(v && v.trim()) names.push({name:v.trim(),score:0,combo:0});
    }
    if(names.length < 2){ alert('Need at least 2 players for multiplayer.'); return; }
    players = names;
  }
  renderPlayers();
  playSfx('click');
}

/* render top players strip */
function renderPlayers(){
  const strip = document.getElementById('playerStrip');
  strip.innerHTML = '';
  players.forEach(p=>{
    const el = document.createElement('div');
    el.className = 'player-pill';
    el.textContent = p.name;
    strip.appendChild(el);
  });
}

/* -------------------------
   Full quiz bank (unchanged)
   ------------------------- */
const allQuestions = {
  akit:[{q:'What is the capital of France?',a:['Paris','London','Berlin','Madrid'],correct:0},{q:'2 + 2 √ó 2 = ?',a:['6','8','4','2'],correct:0},{q:'Who created AKit?',a:['Adam','Elon Musk','Bill Gates','Adam & Alex'],correct:3},{q:'Which language runs in a web browser?',a:['Python','C++','JavaScript','Java'],correct:2},{q:'Which is not a JS framework?',a:['React','Vue','Python','Angular'],correct:2},{q:'AKit is primarily for?',a:['Games','Quizzes','Photos','Videos'],correct:1},{q:'HTML stands for?',a:['HyperText Markup Language','HighText Main Language','Hyper Trainer Markup','None'],correct:0},{q:'AKit logo color?',a:['Blue','Red','Green','Yellow'],correct:0},{q:'2¬≥ = ?',a:['6','8','9','12'],correct:1},{q:'Bonus fact about AKit?',a:['Made in 2025','Created by Adam & Alex','Open Source','Mobile App'],correct:1}],
  planet:[{q:'Which planet is known as the Red Planet?',a:['Mars','Venus','Jupiter','Mercury'],correct:0},{q:'Largest planet in Solar System?',a:['Earth','Jupiter','Saturn','Neptune'],correct:1},{q:'Planet with rings?',a:['Mars','Saturn','Jupiter','Earth'],correct:1},{q:'Which planet is closest to Sun?',a:['Mercury','Venus','Earth','Mars'],correct:0},{q:'Blue planet?',a:['Mars','Venus','Earth','Neptune'],correct:2},{q:'Planet for largest volcano?',a:['Mars','Jupiter','Earth','Saturn'],correct:0},{q:'Which planet rotates backward?',a:['Venus','Earth','Uranus','Mars'],correct:0},{q:'Planet with shortest day?',a:['Jupiter','Saturn','Mercury','Mars'],correct:0},{q:'Furthest planet?',a:['Neptune','Pluto','Uranus','Saturn'],correct:0},{q:'Gas giant with rings?',a:['Jupiter','Saturn','Uranus','Neptune'],correct:1}],
  tech:[{q:'What does CPU stand for?',a:['Central Processing Unit','Computer Power Unit','Central Print Unit','Control Program Unit'],correct:0},{q:'HTML is used for?',a:['Styling','Content structure','Programming logic','Database'],correct:1},{q:'Which company makes Windows?',a:['Apple','Microsoft','Google','Linux'],correct:1},{q:'Most popular programming language in 2025?',a:['Python','JavaScript','C++','Rust'],correct:1},{q:'What is AI?',a:['Artificial Intelligence','Automatic Input','Auto Image','Application Interface'],correct:0},{q:'JS stands for?',a:['JavaScript','JavaServer','JustScript','JoinScript'],correct:0},{q:'CSS is for?',a:['Design','Logic','Database','Network'],correct:0},{q:'Tech company Apple founded?',a:['1976','1980','1990','2000'],correct:0},{q:'First search engine?',a:['Google','Archie','Bing','Yahoo'],correct:1},{q:'Device to input text?',a:['Keyboard','Mouse','Monitor','Printer'],correct:0}],
  animals:[{q:'Fastest land animal?',a:['Cheetah','Leopard','Horse','Tiger'],correct:0},{q:'King of Jungle?',a:['Lion','Tiger','Elephant','Giraffe'],correct:0},{q:'Largest mammal?',a:['Elephant','Blue Whale','Giraffe','Hippo'],correct:1},{q:'Which animal is known for building dams?',a:['Beaver','Otter','Platypus','Moose'],correct:0},{q:'Animal with longest lifespan?',a:['Turtle','Elephant','Whale','Parrot'],correct:0},{q:'Which animal can fly backwards?',a:['Hummingbird','Bat','Butterfly','Bee'],correct:0},{q:'Which animal sleeps standing?',a:['Horse','Elephant','Cow','Giraffe'],correct:0},{q:'Fastest bird?',a:['Peregrine Falcon','Eagle','Sparrow','Hawk'],correct:0},{q:'Largest land predator?',a:['Polar Bear','Lion','Tiger','Grizzly'],correct:0},{q:'Smallest mammal?',a:['Bumblebee Bat','Mouse','Shrew','Hamster'],correct:0}],
  math:[{q:'5 √ó 6 = ?',a:['30','25','35','20'],correct:0},{q:'Square root of 144?',a:['10','11','12','14'],correct:2},{q:'Pi approx equals?',a:['3.14','3.15','3.41','3.44'],correct:0},{q:'2¬≤ + 3¬≤ = ?',a:['13','12','15','10'],correct:0},{q:'Factorial 4?',a:['24','12','16','8'],correct:0},{q:'10 √∑ 2 = ?',a:['5','2','10','12'],correct:0},{q:'7 √ó 8 = ?',a:['56','48','54','52'],correct:0},{q:'Square root of 81?',a:['9','8','7','10'],correct:0},{q:'5¬≥ = ?',a:['125','15','25','75'],correct:0},{q:'0 + 0 = ?',a:['0','1','10','-1'],correct:0}],
  trivia:[{q:'Which ocean is largest?',a:['Atlantic','Pacific','Indian','Arctic'],correct:1},{q:'How many continents?',a:['5','6','7','8'],correct:2},{q:'First element on periodic table?',a:['Hydrogen','Helium','Lithium','Oxygen'],correct:0},{q:'Which year did the internet become public?',a:['1983','1990','1995','2000'],correct:2},{q:'Largest desert?',a:['Sahara','Gobi','Kalahari','Arabian'],correct:0},{q:'Tallest mountain?',a:['Everest','K2','Kilimanjaro','Mont Blanc'],correct:0},{q:'Longest river?',a:['Nile','Amazon','Yangtze','Mississippi'],correct:0},{q:'Largest country?',a:['Russia','Canada','China','USA'],correct:0},{q:'Smallest country?',a:['Vatican','Monaco','Malta','Liechtenstein'],correct:0},{q:'Fastest car brand?',a:['Bugatti','Ferrari','Tesla','Lamborghini'],correct:0}],
  music:[{q:'Which instrument has valves?',a:['Trumpet','Saxophone','Guitar','Piano'],correct:0},{q:'Which instrument is woodwind?',a:['Trumpet','Saxophone','Drums','Violin'],correct:1},{q:'Which instrument is brass?',a:['Trombone','Saxophone','Flute','Drum'],correct:0},{q:'Trumpet belongs to which family?',a:['Brass','String','Percussion','Woodwind'],correct:0},{q:'Saxophone belongs to which family?',a:['Brass','Woodwind','Percussion','String'],correct:1}]
};

/* -------------------------
   Quiz gameplay state
   ------------------------- */
let qList = [], qIndex = 0, timer = 10, timerInterval = null, currentPlayerIndex = 0;
const questionEl = document.getElementById('question');
const optionsEl = document.getElementById('options');
const feedbackEl = document.getElementById('feedback');
const timerEl = document.getElementById('timer');
const bar = document.getElementById('bar');
const leaderboardEl = document.getElementById('leaderboard');
const achievementsEl = document.getElementById('achievements');
const nextBtn = document.getElementById('nextBtn');

function startQuiz(){
  const gm = lastSelected || selectedGamemode || 'akit';
  qList = JSON.parse(JSON.stringify(allQuestions[gm] || allQuestions.akit));
  qIndex = 0; currentPlayerIndex = 0;
  players.forEach(p=>{p.score=0;p.combo=0});
  document.getElementById('menuCard').classList.add('hidden');
  document.getElementById('quizCard').classList.remove('hidden');
  document.getElementById('endCard').classList.add('hidden');
  showQuestion();
  playSfx('click');
}

function showQuestion(){
  const q = qList[qIndex];
  questionEl.textContent = q.q;
  optionsEl.innerHTML = '';
  q.a.forEach((opt,i)=>{
    const b = document.createElement('button');
    b.className = 'option-btn';
    b.textContent = opt;
    b.onclick = ()=> selectAnswer(i);
    optionsEl.appendChild(b);
  });
  feedbackEl.textContent = '';
  timer = 10; timerEl.textContent = '‚è∞ '+timer+'s'; bar.style.width='100%';
  clearInterval(timerInterval);
  timerInterval = setInterval(()=>{ timer--; timerEl.textContent = '‚è∞ '+timer+'s'; bar.style.width = ((timer/10)*100)+'%'; if(timer<=0){ clearInterval(timerInterval); selectAnswer(-1); } },1000);
  document.getElementById('turnIndicator').textContent = (mode==='solo') ? 'Solo Mode' : 'Turn: '+players[currentPlayerIndex].name;
  nextBtn.style.display='none';
  updateLeaderboard();
}

function selectAnswer(choice){
  clearInterval(timerInterval);
  const q = qList[qIndex];
  const cur = players[currentPlayerIndex];
  const correct = q.correct === choice;
  if(correct){
    feedbackEl.textContent = '‚úÖ Correct!';
    cur.combo++; cur.score += 10 * cur.combo;
    playSfx('correct'); miniConfetti();
  } else {
    feedbackEl.textContent = '‚ùå Wrong! Correct: ' + q.a[q.correct];
    cur.combo = 0; playSfx('wrong');
  }
  achievementsEl.textContent = (cur.combo>=3 ? 'üî• Combo x'+cur.combo : '') + (cur.score>=50 ? ' üèÜ '+cur.score+' pts' : '');
  nextBtn.style.display = 'inline-block';
  nextBtn.onclick = nextHandler;
  updateLeaderboard();
}

function nextHandler(){
  qIndex++;
  if(qIndex >= qList.length){ endQuiz(); return; }
  if(mode === 'multi'){ currentPlayerIndex = (currentPlayerIndex + 1) % players.length; }
  showQuestion();
}

document.getElementById('endBtn').addEventListener('click', ()=>{ if(confirm('End quiz early?')) endQuiz(); });

function updateLeaderboard(){
  leaderboardEl.innerHTML = '';
  players.forEach(p=>{ const r = document.createElement('div'); r.className='lb-row'; r.innerHTML = `<div>${p.name}</div><div>${p.score} pts</div>`; leaderboardEl.appendChild(r); });
}

function endQuiz(){
  document.getElementById('quizCard').classList.add('hidden');
  document.getElementById('endCard').classList.remove('hidden');
  const final = document.getElementById('finalLeaderboard');
  final.innerHTML = '';
  players.sort((a,b)=>b.score-a.score).forEach(p=>{ const r = document.createElement('div'); r.className='lb-row'; r.textContent = p.name + ' ‚Ä¢ ' + p.score + ' pts'; final.appendChild(r); });
  playSfx('win'); confetti();
}

/* small confetti animation */
function miniConfetti(){
  const el = document.createElement('div'); el.style.position='absolute'; el.style.left='50%'; el.style.top='18%'; el.style.transform='translate(-50%,-50%)'; el.style.fontSize='28px'; el.textContent='üéä';
  shell.appendChild(el); setTimeout(()=>el.remove(),900);
}
function confetti(){
  const el = document.createElement('div'); el.style.position='absolute'; el.style.left='50%'; el.style.top='18%'; el.style.transform='translate(-50%,-50%)'; el.style.fontSize='48px'; el.textContent='üéâüéâüéâ';
  shell.appendChild(el); setTimeout(()=>el.remove(),1400);
}

/* back to menu */
document.getElementById('backMenu').addEventListener('click', menuReturn);
function menuReturn(){
  document.getElementById('menuCard').classList.remove('hidden');
  document.getElementById('quizCard').classList.add('hidden');
  document.getElementById('endCard').classList.add('hidden');
  players = []; renderPlayers();
}

/* initial UI state */
document.getElementById('menuCard').style.display = 'block';
document.getElementById('quizCard').classList.add('hidden');
document.getElementById('endCard').classList.add('hidden');

/* keyboard shortcuts */
window.addEventListener('keydown',(e)=>{ if(e.key==='m') document.getElementById('musicToggle').click(); if(e.key==='s') playSfx('click'); });

/* expose for debug in console */
window._akit = { startQuiz, selectGamemode: (m)=>{ selectedGamemode=m; lastSelected=m; } };
</script>
</body>
</html>
